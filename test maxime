<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8" /><title>Mon 1er jeu Phaser</title>
<script
src="//cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js"></script>

<style type="text/css"> body { margin: 0; }</style>
</head>
<body>
<script type="text/javascript">


// Initialisation de la scène Phaser 3
var config = {
  type: Phaser.AUTO,
  width: 5088,
  height: 4576,
  physics: {
    default: 'arcade',
    arcade: {
      gravity: { y: 0}
    }
  },
  scene: {
    preload: preload,
    create: create,
    update: update
  },
  pixelArt : true
};

var game = new Phaser.Game(config);
var player;
var ennemi;
var collectible= true;
var barreDeVie;
var snake= true;
var key = {};
key.snake_anim = true;
var score = 0;
var scoreText = this.add.text(2600, 2600, 'Score: 0', { fontSize: '32px', fill: '#fff' });



function updateScore() {
  score += 1; // ajoute 1 points au score à chaque fois
  scoreText.setText('Score: ' + score); // met à jour le texte affiché avec le nouveau score
}

function collectibleHandler(snake, collectible) {
  collectible.destroy();
  snake.x = Phaser.Math.Between(100, 700);
  snake.y = Phaser.Math.Between(100, 500);
  collectible.x = Phaser.Math.Between(100, 700);
  collectible.y = Phaser.Math.Between(100, 500);
  updateScore(); // ajoute des points au score
}





function collectibleHandler(snake, collectible) {
  collectible.destroy();
  snake.x = Phaser.Math.Between(100, 700);
  snake.y = Phaser.Math.Between(100, 500);
  collectible.x = Phaser.Math.Between(100, 700);
  collectible.y = Phaser.Math.Between(100, 500);
  updateScore(); // ajoute des points au score
}

function collisionHandler(player, snake) {
  // Code pour gérer la collision entre le joueur et l'ennemi
  
  // Arrête l'animation de l'ennemi et le tue
  snake.setFrame(8); // animation de mort
  snake.anims.stop();
  snake.disableBody(true, true);
  
  // Active le collectible après la mort de l'ennemi
  this.piece.enableBody(true, Phaser.Math.Between(100, 700), Phaser.Math.Between(100, 500), true, true);
  this.piece.setPosition(2500, 2200);


}



// Chargement des ressources
function preload() {
  this.load.image('background', 'assets/sky.png');
  this.load.spritesheet('character', 'assets/player.png', { frameWidth: 32, frameHeight: 48 });
  this.load.image("tiles","assets/Tileset.png");
  this.load.tilemapTiledJSON('map',"assets/MonNiveau.json");
  this.load.image('piece', 'assets/collectiblecroix.png');
  this.load.spritesheet('snake', 'assets/Snake.gif', { frameWidth: 32, frameHeight: 32 });
  
}






// Création des éléments de jeu
function create() {

  //ajout de la map
  const map = this.add.tilemap("map");
  const tiles = map.addTilesetImage("Tileset", "tiles");


  
  const sol = map.createLayer("sol", tiles);
  const falaises = map.createLayer("falaises", tiles);
  
  
 

  const batiment = map.createLayer("Batîment", tiles);

  //collission 

  sol.setCollisionByProperty({ estSolide: true }); 
  falaises.setCollisionByProperty({ estSolide: true });
  batiment.setCollisionByProperty({ estSolide: true });

 

  // Ajout du personnage avec ses animations
  //2688
  this.player = this.physics.add.sprite(2688, 2688, 'character');
  this.player.setCollideWorldBounds(true);

  this.physics.add.collider(this.player, batiment);
  this.physics.add.collider(this.player, falaises);
  this.physics.add.collider(this.player, sol);



  this.anims.create({
    key: 'left',
    frames: this.anims.generateFrameNumbers('character', { start: 3, end: 5}),
    frameRate: 10,
    repeat: -1

  });
  this.anims.create({
    key: 'right',
    frames: this.anims.generateFrameNumbers('character', { start: 6, end: 8}),
    frameRate: 10,
    repeat: -1
  });
  this.anims.create({
    key: 'up',
    frames: this.anims.generateFrameNumbers('character', { start: 9, end: 11}),
    frameRate: 10,
    repeat: -1
  });
  this.anims.create({
    key: 'down',
    frames: this.anims.generateFrameNumbers('character', { start: 0, end: 2}),
    frameRate: 10,
    repeat: -1
  });

  // Configuration des touches directionnelles pour le mouvement du personnage
  this.cursors = this.input.keyboard.createCursorKeys();
  this.cameras.main.setBounds(0,0,5088,4576);
  this.cameras.main.setSize(1920,1080);
  this.cameras.main.startFollow(this.player);
  this.cameras.main.setZoom(1)

   // Ajouter l'ennemi
   this.snake = this.physics.add.sprite(2500, 2200, 'snake');
    this.snake.setScale(2); // changer l'échelle de l'ennemi
    this.snake.setCollideWorldBounds(true); // s'assurer que l'ennemi reste dans la zone de jeu
    this.anims.create({
       key: 'snake_anim',
        frames: this.anims.generateFrameNumbers('snake', { start: 0, end: 7 }),
        frameRate: 8,
        repeat: -1
    });
    this.snake.play('snake_anim');


    // Ajouter le collectible
    this.piece = this.physics.add.sprite(0, 0, 'piece');
    this.piece.disableBody(true, true); // désactiver le corps de collision du collectible pour le moment

    //Définir les collisions entre les sprites
    this.physics.add.collider(this.player, this.snake, collisionHandler, null, this);

    scoreText = this.add.text(16, 16, 'Score: 0', { fontSize: '32px', fill: '#fff' });

    
}
  





// Mise à jour de la scène
function update() {

  // Réinitialisation de la vitesse du personnage
  this.player.setVelocity(0);

  // Mouvement horizontal et vertical du personnage
  if (this.cursors.left.isDown && this.cursors.up.isDown) {
    this.player.setVelocityX(-160);
    this.player.setVelocityY(-160);
    this.player.anims.play('left', true);
  }
  else if (this.cursors.right.isDown && this.cursors.up.isDown) {
    this.player.setVelocityX(160);
    this.player.setVelocityY(-160);
    this.player.anims.play('right', true);
  }
  else if (this.cursors.left.isDown && this.cursors.down.isDown) {
    this.player.setVelocityX(-160);
    this.player.setVelocityY(160);
    this.player.anims.play('left', true);
  }
  else if (this.cursors.right.isDown && this.cursors.down.isDown) {
    this.player.setVelocityX(160);
    this.player.setVelocityY(160);
    this.player.anims.play('right', true);
  
  }
  
   
if (this.cursors.left.isDown) {
    this.player.setVelocityX(-160);
    this.player.anims.play('left', true);
  }
  else if (this.cursors.right.isDown) {
    this.player.setVelocityX(160);
    this.player.anims.play('right', true);
  }
}

</script>
</body>
</html>

